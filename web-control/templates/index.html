<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ESP32-CAM Control</title>
        <link href="css/entireframework.min.css" rel="stylesheet" type="text/css">
        <link href="css/custom.css" rel="stylesheet" type="text/css">
        <link href="css/style.css" rel="stylesheet" type="text/css">
        <style>

        </style>
    </head>
    <body>
        <h1>ESP32-CAM Control</h1>
        <div class="container" style="max-width = 100%;">
            <!-- Video Stream -->
            <img class="video-stream" id="camera-feed" alt="Video Stream" src="http://192.168.1.137:81/stream" style="width = 50vh;max-width = 50vh; height = 70vh;">
            <!-- Controls Container -->
            <div class="controls-container">
                <!-- Mode Controls -->
                <div class="mode-controls">
                    <button id="mode-toggle">Chuyển sang chế độ tự động</button>
                </div>
                <!-- Speeed -->
                <div class="speed-settings">Speed Settings</div>
            <div class="wrapper">
                <input type="radio" name="speed-settings" id="option-1" value="slow-speed" %SPEED_SLOW_STATUS%>
                <input type="radio" name="speed-settings" id="option-2" value="normal-speed" %SPEED_NORMAL_STATUS%>
                <input type="radio" name="speed-settings" id="option-3" value="fast-speed" %SPEED_FAST_STATUS%>
                <label for="option-1" class="option option-1">
                    <div class="dot"></div>
                    <span>Slow</span>
                </label>
                <label for="option-2" class="option option-2">
                    <div class="dot"></div>
                    <span>Normal</span>
                </label>
                <label for="option-3" class="option option-3">
                    <div class="dot"></div>
                    <span>Fast</span>
                </label>
            </div>

                <!-- Servo Angle Slider -->
                <div class="servo-slider">
                    <input type="range" id="servo-angle" name="servo-angle" min="60" max="120" value="90">
                    <div id="servo-angle-value">90</div>
                </div>

                <!-- Controls -->
                <div class="set blue">
                    <nav class="o-pad">
                        <a class="up control" id ="upButton" data-direction="up"></a>
                        <a class="right control" id ="rightButton" data-direction="right"></a>
                        <a class="down control" id ="downButton" data-direction="down"></a>
                        <a class="left control" id ="leftButton" data-direction="left"></a>
                    </nav>
                </div>

                <!-- Light Controls -->
                <div class="light-controls">
                    <button id="light-on">Bật đèn</button>
                    <button id="light-off" class="light-off">Tắt đèn</button>
                </div>

                <!-- Camera Controls -->
                <div class="camera-controls">
                    <button id="camera-on">Bật Camera</button>
                    <button id="camera-off">Tắt Camera</button>
                </div>

                <!-- Logo -->
                <div class="logo">
                    <img src="https://steamsolutions.com.vn/wp-content/uploads/2022/11/LOGO-TEKY-01-Larry-Pham-768x264.png" alt="Logo">
                </div>
            </div>
        </div>

<script>
        document.getElementById('mode-toggle').addEventListener('click', function() {
            fetch('/mode')
                .then(response => response.json())
                .then(data => {
                    if (data.mode === 'manual') {
                        document.getElementById('mode-toggle').textContent = 'Chuyển sang chế độ tự động';
                    } else {
                        document.getElementById('mode-toggle').textContent = 'Chuyển sang chế độ thủ công';
                    }
                });
        });

        document.getElementById('servo-angle').addEventListener('input', function() {
            const angle = document.getElementById('servo-angle').value;
            document.getElementById('servo-angle-value').textContent = angle;
            fetch(`/servo?angle=${angle}`);
        });

        let intervalId;

        document.querySelector('.left.control').addEventListener('mousedown', function() {
            intervalId = setInterval(function() {
                let angle = parseInt(document.getElementById('servo-angle').value);
                if (angle > 60) {
                    angle = Math.max(60, angle - 1);
                    document.getElementById('servo-angle').value = angle;
                    document.getElementById('servo-angle-value').textContent = angle;
                    fetch(`/servo?angle=${angle}`);
                }
            }, 100);
        });

        document.querySelector('.left.control').addEventListener('mouseup', function() {
            clearInterval(intervalId);
        });

        document.querySelector('.right.control').addEventListener('mousedown', function() {
            intervalId = setInterval(function() {
                let angle = parseInt(document.getElementById('servo-angle').value);
                if (angle < 120) {
                    angle = Math.min(120, angle + 1);
                    document.getElementById('servo-angle').value = angle;
                    document.getElementById('servo-angle-value').textContent = angle;
                    fetch(`/servo?angle=${angle}`);
                }
            }, 100);
        });

        document.querySelector('.right.control').addEventListener('mouseup', function() {
            clearInterval(intervalId);
        });

        document.body.requestPointerLock();
        document.addEventListener('keydown', function(event) {
            if (event.key === 'ArrowLeft' && !intervalId) {
                intervalId = setInterval(function() {
                    let angle = parseInt(document.getElementById('servo-angle').value);
                    if (angle > 60) {
                        angle = Math.max(60, angle - 1);
                        document.getElementById('servo-angle').value = angle;
                        document.getElementById('servo-angle-value').textContent = angle;
                        fetch(`/servo?angle=${angle}`);
                    }
                }, 100);
            } else if (event.key === 'ArrowRight' && !intervalId) {
                intervalId = setInterval(function() {
                    let angle = parseInt(document.getElementById('servo-angle').value);
                    if (angle < 120) {
                        angle = Math.min(120, angle + 1);
                        document.getElementById('servo-angle').value = angle;
                        document.getElementById('servo-angle-value').textContent = angle;
                        fetch(`/servo?angle=${angle}`);
                    }
                }, 100);
            }
        });

        document.addEventListener('keyup', function(event) {
            if (event.key === 'ArrowLeft' || event.key === 'ArrowRight') {
                clearInterval(intervalId);
                intervalId = null;
            }
        });

    </script>
    </body>
</html>
